<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; background:#e0e5ec; margin:0; padding:12px; color:#333;}
h1,h2{text-align:center;margin:8px 0;}
/* ======= –ñ–∏–¥–∫–æ–µ —Å—Ç–µ–∫–ª–æ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ ======= */
.card{
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 8px 32px rgba(31,38,135,0.1);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.25);
  transition: transform 0.2s;
}
.card:hover{ transform: translateY(-2px); }

label{display:block;font-weight:600;margin-top:10px;color:#555;font-size:16px;}
input,select{width:100%;padding:12px;margin-top:6px;border-radius:14px;border:1px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.15);color:#333;font-size:16px;box-sizing:border-box;backdrop-filter: blur(4px);}
input::placeholder{color:rgba(0,0,0,0.4);}

button{
  width:100%;padding:14px;margin-top:14px;font-size:18px;font-weight:bold;color:#fff;background: rgba(255,255,255,0.15);border:none;border-radius:14px;
  cursor:pointer;backdrop-filter: blur(6px);transition:0.2s, transform 0.2s;
}
button:hover{ transform: translateY(-2px); background: rgba(255,255,255,0.25);}
button:active{ transform: translateY(0px); background: rgba(255,255,255,0.3);}
.delete-day-btn{background: rgba(255,0,0,0.25); color:#fff;}
.delete-day-btn:hover{background: rgba(255,0,0,0.4);}
.debt-item{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.2);margin-bottom:6px;}
.debt-item span{font-weight:600;font-size:15px;}
.edit-btn,.delete-btn{margin-top:6px;cursor:pointer;padding:6px 10px;border:none;border-radius:12px;color:#fff;font-size:14px;backdrop-filter: blur(6px);}
.edit-btn{background: rgba(0,123,255,0.25);}
.edit-btn:hover{background: rgba(0,123,255,0.4);}
.delete-btn{background: rgba(255,0,0,0.25);}
.delete-btn:hover{background: rgba(255,0,0,0.4);}
nav{display:flex;justify-content:space-around;margin-bottom:12px;}
nav button{width:auto;padding:10px 20px;background: rgba(255,255,255,0.15);border-radius:14px;font-size:16px;backdrop-filter: blur(6px);transition:0.2s;}
nav button.active{background: rgba(255,255,255,0.25);}
.result span.savings{color:#007BFF;font-weight:600;}
.result span.free{color:#4CAF50;font-weight:600;}
.result span.warning{color:#E53935;font-weight:600;}
@media(max-width:400px){.debt-item{font-size:14px;}.edit-btn,.delete-btn{padding:5px 8px;font-size:13px;}}
</style>
</head>
<body>

<nav>
  <button id="btn-home" class="active" onclick="showPage('home')">–°–µ–≥–æ–¥–Ω—è</button>
  <button id="btn-debts" onclick="showPage('debts')">–î–æ–ª–≥–∏</button>
</nav>

<div id="home" class="page">
  <h1>–°–µ–≥–æ–¥–Ω—è: <span id="today-date"></span></h1>
  <div class="card">
    <label for="hours">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</label>
    <input type="number" id="hours" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 6">
    <label for="income">–ó–∞—Ä–∞–±–æ—Ç–∞–ª —Å–µ–≥–æ–¥–Ω—è (‚ÇΩ)</label>
    <input type="number" id="income" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 3500">
    <button onclick="saveDay()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å</button>
    <button class="delete-day-btn" onclick="deleteTodayData()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å</button>
  </div>
  <div class="card">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <div class="result" id="output">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª.</div>
  </div>
  <div class="card">
    <h2>–ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–æ–≤</h2>
    <canvas id="incomeChart" style="width:100%;height:220px;"></canvas>
  </div>
</div>

<div id="debts" class="page" style="display:none;">
  <div class="card">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞</label>
    <input type="text" id="debt-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ö—Ä–µ–¥–∏—Ç">
    <label>–û–±—â–∞—è —Å—É–º–º–∞ (‚ÇΩ)</label>
    <input type="number" id="debt-total" placeholder="15000">
    <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ (‚ÇΩ)</label>
    <input type="number" id="debt-monthly" placeholder="5000">
    <label>–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞</label>
    <input type="date" id="debt-date">
    <button onclick="addDebt()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</button>
  </div>
  <div class="card">
    <h2>–°–ø–∏—Å–æ–∫ –¥–æ–ª–≥–æ–≤</h2>
    <div id="debts-list"></div>
    <div style="margin-top:10px;font-weight:bold;">–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–æ–≤: <span id="debts-total">0 ‚ÇΩ</span></div>
  </div>
</div>

<script>
// –ù–∞–≤–∏–≥–∞—Ü–∏—è
function showPage(pageId){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(pageId).style.display='block';
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  if(pageId==='home') document.getElementById('btn-home').classList.add('active');
  else document.getElementById('btn-debts').classList.add('active');
}

// –î–∞—Ç–∞
function setTodayDate(){ document.getElementById('today-date').innerText = new Date().toLocaleDateString(); }
setTodayDate();

// –î–æ–ª–≥–∏
let debts = JSON.parse(localStorage.getItem('debts'))||[];
function saveDebts(){ localStorage.setItem('debts',JSON.stringify(debts)); }
function renderDebts(){
  const list = document.getElementById('debts-list'); list.innerHTML=''; let total=0;
  debts.forEach((d,i)=>{
    total+=Number(d.monthly);
    const div=document.createElement('div'); div.className='debt-item';
    div.innerHTML=`<span>${d.name}: ${d.total} ‚ÇΩ (–º–µ—Å. ${d.monthly} ‚ÇΩ) | –ü–ª–∞—Ç—ë–∂: ${d.date || '-'}</span>
      <div><button class="edit-btn" onclick="editDebt(${i})">‚úèÔ∏è</button><button class="delete-btn" onclick="deleteDebt(${i})">üóëÔ∏è</button></div>`;
    list.appendChild(div);
  });
  document.getElementById('debts-total').innerText = total+' ‚ÇΩ';
}
function addDebt(){
  const name=document.getElementById('debt-name').value;
  const total=Number(document.getElementById('debt-total').value);
  const monthly=Number(document.getElementById('debt-monthly').value);
  const date=document.getElementById('debt-date').value;
  if(!name||!total||!monthly) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
  debts.push({name,total,monthly,date}); saveDebts(); renderDebts();
  document.getElementById('debt-name').value=''; document.getElementById('debt-total').value=''; document.getElementById('debt-monthly').value=''; document.getElementById('debt-date').value='';
}
function deleteDebt(i){ debts.splice(i,1); saveDebts(); renderDebts(); }
function editDebt(i){
  const d=debts[i];
  const newName=prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞:",d.name);
  const newTotal=prompt("–û–±—â–∞—è —Å—É–º–º–∞:",d.total);
  const newMonthly=prompt("–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂:",d.monthly);
  const newDate=prompt("–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ (YYYY-MM-DD):",d.date||'');
  if(newName&&newTotal&&newMonthly){ debts[i]={name:newName,total:Number(newTotal),monthly:Number(newMonthly),date:newDate}; saveDebts(); renderDebts(); }
}

// –ì–ª–∞–≤–Ω–∞—è
const LIFE_MONTH = 25000; const SAVE_PERCENT=0.3;
let todayData = JSON.parse(localStorage.getItem('todayData'))||[];
function saveDay(){
  const hours=Number(document.getElementById('hours').value); const income=Number(document.getElementById('income').value);
  if(!income||income<0) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ—Ö–æ–¥");
  const debtSum = debts.reduce((a,d)=>a+Number(d.monthly),0);
  const rest = income-LIFE_MONTH/30 - debtSum;
  const savings = rest>0?Math.round(rest*SAVE_PERCENT):0;
  const free = rest>0?Math.round(rest*(1-SAVE_PERCENT)):0;
  const today = new Date().toLocaleDateString();
  todayData.push({date:today,income,hours,savings,free}); localStorage.setItem('todayData',JSON.stringify(todayData));
  renderToday(); renderChart();
}
function renderToday(){
  const output=document.getElementById('output');
  if(!todayData.length){ output.innerHTML="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª."; return; }
  const last=todayData[todayData.length-1];
  const debtSum = debts.reduce((a,d)=>a+Number(d.monthly),0);
  const rest = last.income-LIFE_MONTH/30 - debtSum;
  const savings = rest>0?Math.round(rest*SAVE_PERCENT):0;
  const free = rest>0?Math.round(rest*(1-SAVE_PERCENT)):0;
  let text=`üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–ª: <span>${last.income} ‚ÇΩ</span><br>üè† –ù–∞ –∂–∏–∑–Ω—å: <span>${Math.round(LIFE_MONTH/30)} ‚ÇΩ</span><br>üí≥ –î–æ–ª–≥–∏: <span>${debtSum} ‚ÇΩ</span><br>`;
  if(rest>0){ text+=`üìà –ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å: <span class="savings">${savings} ‚ÇΩ</span><br>üü¢ –°–≤–æ–±–æ–¥–Ω–æ: <span class="free">${free} ‚ÇΩ</span>`; }
  else{text+=`<span class="warning">–û—Å—Ç–∞—Ç–æ–∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, —Å–µ–≥–æ–¥–Ω—è –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º</span>`;}
  output.innerHTML=text;
}
function deleteTodayData(){
  if(!todayData.length) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
  if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–≤–µ–¥—ë–Ω–Ω—ã–π –¥–µ–Ω—å?")){ todayData.pop(); localStorage.setItem('todayData',JSON.stringify(todayData)); renderToday(); renderChart(); }
}
// –ì—Ä–∞—Ñ–∏–∫
let chart;
function renderChart(){
  const ctx=document.getElementById('incomeChart').getContext('2d');
  const labels = todayData.map(d=>d.date);
  const dataSavings = todayData.map(d=>{
    const debtSum = debts.reduce((a,debt)=>a+Number(debt.monthly),0);
    const rest = d.income - LIFE_MONTH/30 - debtSum; return rest>0?Math.round(rest*SAVE_PERCENT):0;
  });
  const dataUsed = todayData.map(d=>{
    const debtSum = debts.reduce((a,debt)=>a+Number(debt.monthly),0);
    const rest = d.income - LIFE_MONTH/30 - debtSum; return d.income - (rest>0?Math.round(rest*SAVE_PERCENT):0);
  });
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{labels,datasets:[
      {label:'–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π', data:dataSavings, backgroundColor:'rgba(76,175,80,0.7)'},
      {label:'–†–∞—Å—Ö–æ–¥—ã (–∂–∏–∑–Ω—å + –¥–æ–ª–≥–∏)', data:dataUsed, backgroundColor:'rgba(158,158,158,0.7)'}
    ]},
    options:{
      responsive:true,
      plugins:{legend:{position:'top'}, tooltip:{callbacks:{label:function(context){return context.dataset.label==='–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π'? '–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è: '+context.raw+' ‚ÇΩ':'–†–∞—Å—Ö–æ–¥—ã: '+context.raw+' ‚ÇΩ';}}}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
renderDebts(); renderToday(); renderChart();
</script>
</body>
</html>
