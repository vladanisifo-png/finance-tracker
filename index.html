<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  margin:0; padding:12px;
  color:#333;
  transition: background 0.3s;
  background-size: cover;
  background-position: center;
  overflow-x: hidden;
}

#animationCanvas {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:9999;
  background: linear-gradient(120deg,#111 0%,#222 100%);
}

.card {
  background: rgba(255,255,255,0.2);
  border-radius: 30px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.06),0 8px 18px rgba(0,0,0,0.04);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border: 1px solid rgba(255,255,255,0.25);
  transition: transform 0.3s,box-shadow 0.3s,background 0.3s;
}
.card:hover { transform:translateY(-5px); box-shadow:0 25px 50px rgba(0,0,0,0.1),0 15px 30px rgba(0,0,0,0.07); }

label { display:block;font-weight:600;margin-top:10px;color:#555;font-size:16px; }
input, select {
  width:100%; padding:12px; margin-top:6px;
  border-radius:16px; border:1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.15); color:#333; font-size:16px;
  box-sizing:border-box; backdrop-filter: blur(4px);
}
input::placeholder{color: rgba(0,0,0,0.4);}

button {
  width:100%; padding:16px; margin-top:16px;
  font-size:18px; font-weight:bold; color:#fff;
  background: linear-gradient(135deg, rgba(76,175,80,0.7), rgba(56,142,60,0.7));
  border:none; border-radius:20px; cursor:pointer;
  backdrop-filter: blur(15px); transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
}
button:hover { transform:translateY(-3px); background: linear-gradient(135deg, rgba(76,175,80,0.85), rgba(56,142,60,0.85)); box-shadow:0 10px 25px rgba(0,0,0,0.1); }
button:active { transform:translateY(0); background: linear-gradient(135deg, rgba(56,142,60,0.85), rgba(76,175,80,0.85)); box-shadow:0 4px 10px rgba(0,0,0,0.05); }
.delete-day-btn { background: rgba(255,0,0,0.6); }
.delete-day-btn:hover { background: rgba(255,0,0,0.8); }

nav { display:flex; justify-content:space-around; margin-bottom:12px; position:relative; z-index:1; }
nav button { width:auto; padding:10px 20px; background: rgba(255,255,255,0.2); border-radius:14px; font-size:16px; backdrop-filter: blur(6px); transition:0.2s; }
nav button.active { background: rgba(255,255,255,0.35); }

.result span.savings { color:#007BFF;font-weight:600; }
.result span.life { color:#FFC107;font-weight:600; }

.page { position: relative; z-index:1; }

@media(max-width:400px){ .edit-btn,.delete-btn{padding:5px 8px;font-size:13px;} }
</style>
</head>
<body>

<canvas id="animationCanvas"></canvas>

<nav>
  <button id="btn-home" class="active" onclick="showPage('home')">–°–µ–≥–æ–¥–Ω—è</button>
  <button id="btn-debts" onclick="showPage('debts')">–î–æ–ª–≥–∏</button>
  <button id="btn-settings" onclick="showPage('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<div id="home" class="page">
  <h1>–°–µ–≥–æ–¥–Ω—è: <span id="today-date"></span></h1>
  <div class="card">
    <label for="income">–ó–∞—Ä–∞–±–æ—Ç–∞–ª —Å–µ–≥–æ–¥–Ω—è (‚ÇΩ)</label>
    <input type="number" id="income" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 3500">
    <button onclick="saveDay()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å</button>
    <button class="delete-day-btn" onclick="deleteTodayData()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å</button>
  </div>
  <div class="card">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <div class="result" id="output">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª.</div>
  </div>
  <div class="card">
    <h2>–ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–æ–≤</h2>
    <canvas id="incomeChart" style="width:100%;height:220px;"></canvas>
  </div>
</div>

<div id="debts" class="page">
  <div class="card">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞</label>
    <input type="text" id="debt-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ö—Ä–µ–¥–∏—Ç">
    <label>–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞ (‚ÇΩ)</label>
    <input type="number" id="debt-total" placeholder="50000">
    <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ (‚ÇΩ)</label>
    <input type="number" id="debt-monthly" placeholder="5000">
    <button onclick="addDebt()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</button>
  </div>
  <div class="card">
    <h2>–°–ø–∏—Å–æ–∫ –¥–æ–ª–≥–æ–≤</h2>
    <div id="debts-list"></div>
    <div style="margin-top:10px;font-weight:bold;">–°—É–º–º–∞ –≤—Å–µ—Ö –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π: <span id="debts-total">0 ‚ÇΩ</span></div>
  </div>
</div>

<div id="settings" class="page">
  <div class="card">
    <label>–°—É–º–º–∞ –Ω–∞ –∂–∏–∑–Ω—å –∑–∞ –º–µ—Å—è—Ü (‚ÇΩ)</label>
    <input type="number" id="life-month" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 25000" value="25000">
    <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
    <input type="color" id="bg-color" value="#e0e5ec">
    <label>–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫</label>
    <input type="color" id="btn-color" value="#4caf50">
    <label>–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ –¥–ª—è —Ñ–æ–Ω–∞</label>
    <input type="file" id="bg-image" accept="image/*">
    <button onclick="applyBackgroundImage()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω</button>
    <button onclick="removeBackgroundImage()" style="background:rgba(255,0,0,0.6)">–£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω</button>
    <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>
</div>

<script>
// ==== –ù–∞–≤–∏–≥–∞—Ü–∏—è ====
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('btn-'+id).classList.add('active');
}

// ==== LocalStorage ====
let debts = JSON.parse(localStorage.getItem('debts'))||[];
let todayData = JSON.parse(localStorage.getItem('todayData'))||[];
let settings = JSON.parse(localStorage.getItem('settings'))||{lifeMonth:25000,bgColor:'#e0e5ec',btnColor:'#4caf50',savePercent:0.3,bgImage:null};

// ==== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ====
function saveSettings(){
  const life = Number(document.getElementById('life-month').value);
  const bg = document.getElementById('bg-color').value;
  const btn = document.getElementById('btn-color').value;
  if(life>0) settings.lifeMonth=life;
  if(bg) settings.bgColor=bg;
  if(btn) settings.btnColor=btn;
  localStorage.setItem('settings',JSON.stringify(settings));
  applyBackgroundFromSettings();
  document.querySelectorAll('button').forEach(b=>b.style.background=settings.btnColor);
  alert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
}
function applyBackgroundFromSettings(){
  if(settings.bgImage){
    document.body.style.backgroundImage = `url(${settings.bgImage})`;
    document.body.style.backgroundSize = "cover";
    document.body.style.backgroundPosition = "center";
  } else {
    document.body.style.backgroundImage = "";
    document.body.style.background = settings.bgColor;
  }
}
function applyBackgroundImage(){
  const fileInput = document.getElementById('bg-image');
  if(fileInput.files && fileInput.files[0]){
    const reader = new FileReader();
    reader.onload = function(e){
      settings.bgImage = e.target.result;
      localStorage.setItem('settings',JSON.stringify(settings));
      applyBackgroundFromSettings();
    }
    reader.readAsDataURL(fileInput.files[0]);
  }
}
function removeBackgroundImage(){
  if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω?")){
    settings.bgImage = null;
    localStorage.setItem('settings',JSON.stringify(settings));
    applyBackgroundFromSettings();
  }
}

// ==== –î–æ–ª–≥–∏ ====
function saveDebts(){ localStorage.setItem('debts',JSON.stringify(debts)); }
function renderDebts(){
  const list = document.getElementById('debts-list'); list.innerHTML=''; let total=0;
  debts.forEach((d,i)=>{
    total+=Number(d.monthly);
    const div = document.createElement('div'); div.className='debt-item';
    div.innerHTML=`<span>${d.name}: –û–±—â–∞—è —Å—É–º–º–∞ ${d.total} ‚ÇΩ, –ú–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ ${d.monthly} ‚ÇΩ</span>
      <div><button class="edit-btn" onclick="editDebt(${i})">‚úèÔ∏è</button>
      <button class="delete-btn" onclick="deleteDebt(${i})">üóëÔ∏è</button></div>`;
    list.appendChild(div);
  });
  document.getElementById('debts-total').innerText=total+' ‚ÇΩ';
}
function addDebt(){
  const name=document.getElementById('debt-name').value;
  const total=Number(document.getElementById('debt-total').value);
  const monthly=Number(document.getElementById('debt-monthly').value);
  if(!name||!total||!monthly) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
  debts.push({name,total,monthly});
  saveDebts(); renderDebts();
  document.getElementById('debt-name').value=''; document.getElementById('debt-total').value=''; document.getElementById('debt-monthly').value='';
}
function deleteDebt(i){ debts.splice(i,1); saveDebts(); renderDebts(); }
function editDebt(i){
  const d=debts[i];
  const newName=prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞:",d.name);
  const newTotal=prompt("–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞:",d.total);
  const newMonthly=prompt("–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂:",d.monthly);
  if(newName&&newTotal&&newMonthly){ debts[i]={name:newName,total:Number(newTotal),monthly:Number(newMonthly)}; saveDebts(); renderDebts(); }
}

// ==== –ì–ª–∞–≤–Ω–∞—è ====
function daysLeftInMonth(){ const today=new Date(); const lastDay=new Date(today.getFullYear(),today.getMonth()+1,0); return lastDay.getDate()-today.getDate()+1; }
function getLifePerDay(){ const today=new Date(); const daysInMonth = new Date(today.getFullYear(), today.getMonth()+1, 0).getDate(); return settings.lifeMonth / daysInMonth; }

function saveDay(){
  const income=Number(document.getElementById('income').value); 
  if(!income||income<0) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–æ—Ö–æ–¥!");

  const debtSum = debts.reduce((a,d)=>a+Number(d.monthly),0);
  const leftDays = daysLeftInMonth();
  const dailyDebt=debtSum/leftDays;

  const restAfterDebt = income - dailyDebt;
  const lifeMinPerDay = getLifePerDay();
  let savings = 0;
  let life = 0;

  if(restAfterDebt <= lifeMinPerDay){
    life = restAfterDebt;
    savings = 0;
  } else {
    const maxSavings = restAfterDebt - lifeMinPerDay;
    const percentSavings = restAfterDebt * settings.savePercent;
    savings = Math.min(maxSavings, percentSavings);
    life = restAfterDebt - savings;
  }

  const today=new Date().toLocaleDateString();
  todayData.push({date:today,income,life,dailyDebt,savings});
  localStorage.setItem('todayData',JSON.stringify(todayData));
  renderToday(); renderChart();
}

function renderToday(){
  const output=document.getElementById('output');
  if(!todayData.length){ output.innerHTML="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª."; return; }
  const last=todayData[todayData.length-1];
  output.innerHTML=`
    üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–ª: ${last.income} ‚ÇΩ<br>
    üí≥ –ù–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂: ${Math.round(last.dailyDebt)} ‚ÇΩ<br>
    üè† –ù–∞ –∂–∏–∑–Ω—å: <span class="life">${Math.round(last.life)} ‚ÇΩ</span><br>
    üìà –ù–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è: <span class="savings">${Math.round(last.savings)} ‚ÇΩ</span>
  `;
}

function deleteTodayData(){
  if(!todayData.length) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
  if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å?")){ todayData.pop(); localStorage.setItem('todayData',JSON.stringify(todayData)); renderToday(); renderChart(); }
}

// ==== –ì—Ä–∞—Ñ–∏–∫ ====
let chart;
function renderChart(){
  const ctx=document.getElementById('incomeChart').getContext('2d');
  const labels=todayData.map(d=>d.date);
  const dataLife=todayData.map(d=>d.life);
  const dataDebt=todayData.map(d=>d.dailyDebt);
  const dataSavings=todayData.map(d=>d.savings);
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{labels,datasets:[
      {label:'–ñ–∏–∑–Ω—å', data:dataLife, backgroundColor:'rgba(255,193,7,0.7)'},
      {label:'–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂', data:dataDebt, backgroundColor:'rgba(244,67,54,0.7)'},
      {label:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è', data:dataSavings, backgroundColor:'rgba(33,150,243,0.7)'}
    ]},
    options:{responsive:true,plugins:{legend:{position:'top'}},scales:{x:{stacked:true}, y:{stacked:true,beginAtZero:true}}}
  });
}

// ==== –î–∞—Ç–∞ ====
function setToday(){ document.getElementById('today-date').innerText = new Date().toLocaleDateString(); }
setToday();

// ==== –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–µ–º–æ–π –º–æ–Ω–µ—Ç—ã —Å —Ä—É–∫–æ–π ====
function startAnimation(){
  const canvas=document.getElementById('animationCanvas');
  const ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;

  let frame = 0;
  const totalFrames = 300; // ~5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 60fps

  // –ú–æ–Ω–µ—Ç–∞
  const coin = {x:centerX, y:centerY+150, vy:-15, angle:0, vAngle:0.3, landed:false};

  function drawHand(progress){
    ctx.save();
    ctx.translate(centerX,centerY+150);
    ctx.rotate(-Math.PI/8*(1-progress)); // —Ä—É–∫–∞ –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–µ—Ç –º–æ–Ω–µ—Ç—É
    ctx.fillStyle = '#d2a679';
    ctx.fillRect(-20,0,40,80);
    ctx.restore();
  }

  function drawCoin(){
    ctx.save();
    ctx.translate(coin.x,coin.y);
    ctx.rotate(coin.angle);
    ctx.beginPath();
    ctx.arc(0,0,30,0,2*Math.PI);
    ctx.fillStyle='gold';
    ctx.fill();
    ctx.lineWidth=2;
    ctx.strokeStyle='darkgoldenrod';
    ctx.stroke();
    ctx.fillStyle='black';
    ctx.font='24px Arial';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillText('‚ÇΩ',0,0);
    ctx.restore();
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
    if(!coin.landed){
      coin.y += coin.vy;
      coin.vy += 0.5; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
      coin.angle += coin.vAngle;
      if(coin.y >= centerY){
        coin.y = centerY;
        coin.vy = 0;
        coin.vAngle = 0;
        coin.landed = true;
      }
    }

    // —Ä–∏—Å—É–µ–º —Ä—É–∫—É, –µ—Å–ª–∏ –º–æ–Ω–µ—Ç–∞ –µ—â–µ –≤ –≤–æ–∑–¥—É—Ö–µ
    if(!coin.landed) drawHand(coin.y/ (centerY+150));

    // —Ä–∏—Å—É–µ–º –º–æ–Ω–µ—Ç—É
    drawCoin();

    frame++;
    if(frame<totalFrames){
      requestAnimationFrame(animate);
    } else {
      canvas.style.display='none';
      document.querySelectorAll('.page').forEach(p=>p.style.display='block');
    }
   }

  requestAnimationFrame(animate);
}

// ==== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM ====
document.addEventListener('DOMContentLoaded',()=>{
  document.querySelectorAll('.page').forEach(p=>p.style.display='none'); // —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  applyBackgroundFromSettings();
  startAnimation(); // –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è –º–æ–Ω–µ—Ç—ã
  renderDebts();
  renderToday();
  renderChart();
  document.querySelectorAll('button').forEach(b=>b.style.background=settings.btnColor);
});
</script>
</body>
</html>
