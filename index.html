<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Финансовый трекер</title>
<style>
body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family: Arial, sans-serif; background: linear-gradient(120deg,#111 0%,#222 100%);}
canvas { display:block; position:absolute; top:0; left:0; z-index:1000; }
.container { display:none; padding:20px; color:white; }
.card { backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border-radius:15px; padding:15px; margin-bottom:15px; }
button { backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border:none; border-radius:12px; padding:10px 20px; color:white; cursor:pointer; font-weight:bold; margin:5px; }
button:hover { background: rgba(255,255,255,0.15); }
input { padding:5px; border-radius:8px; border:none; width:100px; margin-right:10px; }
nav { display:flex; justify-content:center; margin-bottom:15px; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<div class="container" id="app">
  <nav>
    <button onclick="showPage('main')">Главная</button>
    <button onclick="showPage('debts')">Долги</button>
    <button onclick="showPage('settings')">Настройки</button>
  </nav>

  <!-- Главная -->
  <div id="mainPage">
    <div class="card">
      <h3>Сегодняшний заработок</h3>
      <input type="number" id="todayIncome" placeholder="Сумма">
      <button onclick="addIncome()">Добавить</button>
      <button onclick="deleteToday()">Удалить</button>
    </div>
    <div class="card">
      <h3>Информация</h3>
      <p>Сумма на жизнь сегодня: <span id="lifeToday">0</span>₽</p>
      <p>Сумма обязательного платежа сегодня: <span id="debtToday">0</span>₽</p>
      <p>Сумма на накопления: <span id="saveToday">0</span>₽</p>
    </div>
  </div>

  <!-- Долги -->
  <div id="debtsPage" style="display:none;">
    <div class="card">
      <h3>Добавить долг</h3>
      <input type="text" id="debtName" placeholder="Название">
      <input type="number" id="debtAmount" placeholder="Сумма">
      <button onclick="addDebt()">Добавить</button>
    </div>
    <div class="card" id="debtsList"></div>
  </div>

  <!-- Настройки -->
  <div id="settingsPage" style="display:none;">
    <div class="card">
      <h3>Настройки</h3>
      <label>Цвет фона: <input type="color" id="bgColor" onchange="updateSettings()"></label>
      <label>Цвет кнопок: <input type="color" id="btnColor" onchange="updateSettings()"></label>
    </div>
  </div>
</div>

<script>
// ------------------- Анимация ₽ -------------------
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const centerX = canvas.width/2;
const centerY = canvas.height/2;

// Символ ₽ для точек
const tempCanvas = document.createElement('canvas');
tempCanvas.width = canvas.width;
tempCanvas.height = canvas.height;
const tctx = tempCanvas.getContext('2d');
const fontSize = Math.min(canvas.width, canvas.height)/2;
tctx.font = `${fontSize}px Arial`;
tctx.textAlign = "center";
tctx.textBaseline = "middle";
tctx.fillText('₽', centerX, centerY);

const imageData = tctx.getImageData(0,0,canvas.width,canvas.height).data;
const points = [];
for(let y=0; y<canvas.height; y+=6){
  for(let x=0; x<canvas.width; x+=6){
    const idx = (y*canvas.width + x)*4;
    if(imageData[idx+3]>128){
      points.push({x,y});
    }
  }
}

const particles = [];
for(let i=0;i<points.length;i++){
  const p = points[i];
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    targetX: p.x,
    targetY: p.y,
    radius: Math.random()*3+2,
    vx:0,
    vy:0
  });
}

let phase = 0; // 0 - сборка точек, 1 - свечение и сплавление, 2 - финальный символ
let glowAlpha = 0;

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(phase === 0){
    let arrivedCount = 0;
    particles.forEach(p=>{
      const dx = p.targetX - p.x;
      const dy = p.targetY - p.y;
      p.vx += dx*0.008;
      p.vy += dy*0.008;
      p.vx *= 0.9;
      p.vy *= 0.9;
      p.x += p.vx;
      p.y += p.vy;

      if(Math.abs(dx)<0.5 && Math.abs(dy)<0.5) arrivedCount++;

      ctx.fillStyle = 'gold';
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
      ctx.fill();
    });

    if(arrivedCount === particles.length) phase = 1;

  } else if(phase === 1){
    glowAlpha += 0.01;
    if(glowAlpha>1) glowAlpha = 1;

    particles.forEach(p=>{
      p.x += (p.targetX - p.x)*0.03;
      p.y += (p.targetY - p.y)*0.03;
      p.radius *= 0.97;
      ctx.fillStyle = `rgba(255,215,0,${0.5*glowAlpha})`;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
      ctx.fill();
    });

    ctx.save();
    ctx.shadowColor = `rgba(255,255,180,${glowAlpha})`;
    ctx.shadowBlur = 60*glowAlpha;
    ctx.fillStyle = 'rgba(255,215,0,0.7)';
    ctx.font = `${fontSize}px Arial`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText('₽', centerX, centerY);
    ctx.restore();

    if(glowAlpha >= 1) phase = 2;

  } else if(phase === 2){
    glowAlpha -= 0.005;
    if(glowAlpha <0) glowAlpha = 0;

    ctx.save();
    ctx.shadowColor = `rgba(255,255,180,${glowAlpha})`;
    ctx.shadowBlur = 20*glowAlpha;
    ctx.fillStyle = 'gold';
    ctx.font = `${fontSize}px Arial`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText('₽', centerX, centerY);
    ctx.restore();
  }

  requestAnimationFrame(animate);
}

// После ~6 секунд анимации открываем приложение
setTimeout(()=>{ document.getElementById('canvas').style.display='none'; document.getElementById('app').style.display='block'; },6000);

animate();

// ------------------- Логика приложения -------------------
let lifeMonth = 15000;
let debts = JSON.parse(localStorage.getItem('debts')||'[]');
let incomes = JSON.parse(localStorage.getItem('incomes')||'{}');

function showPage(page){
  document.getElementById('mainPage').style.display = (page==='main')?'block':'none';
  document.getElementById('debtsPage').style.display = (page==='debts')?'block':'none';
  document.getElementById('settingsPage').style.display = (page==='settings')?'block':'none';
  updateMain();
  updateDebts();
}

function addDebt(){
  const name = document.getElementById('debtName').value;
  const amount = parseFloat(document.getElementById('debtAmount').value);
  if(name && !isNaN(amount)){
    debts.push({name,amount});
    localStorage.setItem('debts',JSON.stringify(debts));
    document.getElementById('debtName').value='';
    document.getElementById('debtAmount').value='';
    updateDebts();
  }
}

function updateDebts(){
  const container = document.getElementById('debtsList');
  container.innerHTML='';
  debts.forEach((d,i)=>{
    const div = document.createElement('div');
    div.innerHTML = `${d.name}: ${d.amount}₽ <button onclick="removeDebt(${i})">Удалить</button>`;
    container.appendChild(div);
  });
}

function removeDebt(i){
  debts.splice(i,1);
  localStorage.setItem('debts',JSON.stringify(debts));
  updateDebts();
}

function addIncome(){
  const today = new Date().toISOString().slice(0,10);
  const val = parseFloat(document.getElementById('todayIncome').value);
  if(!isNaN(val)){
    incomes[today] = val;
    localStorage.setItem('incomes',JSON.stringify(incomes));
    document.getElementById('todayIncome').value='';
    updateMain();
  }
}

function deleteToday(){
  const today = new Date().toISOString().slice(0,10);
  delete incomes[today];
  localStorage.setItem('incomes',JSON.stringify(incomes));
  updateMain();
}

function updateMain(){
  const today = new Date().toISOString().slice(0,10);
  const income = incomes[today]||0;
  const totalDebt = debts.reduce((a,d)=>a+d.amount,0);
  const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth()+1,0).getDate();
  const dayToday = new Date().getDate();
  const remainingDays = daysInMonth - dayToday +1;
  const debtToday = totalDebt/remainingDays;
  const lifeToday = lifeMonth/daysInMonth;
  let saveToday = 0;
  if(income - debtToday > lifeToday){
    saveToday = (income - debtToday)*0.3;
  }
  document.getElementById('lifeToday').innerText = Math.max(income-debtToday-saveToday,0).toFixed(0);
  document.getElementById('debtToday').innerText = debtToday.toFixed(0);
  document.getElementById('saveToday').innerText = saveToday.toFixed(0);
}

// ------------------- Настройки -------------------
function updateSettings(){
  document.body.style.background = document.getElementById('bgColor').value;
  const buttons = document.querySelectorAll('button');
  buttons.forEach(b=>b.style.background = document.getElementById('btnColor').value);
}

showPage('main');
</script>
</body>
</html>
