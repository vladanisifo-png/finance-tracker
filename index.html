<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  margin:0; padding:12px;
  background:#e0e5ec;
  color:#333;
}
h1,h2{text-align:center;margin:8px 0;}

/* ===== –ñ–∏–¥–∫–æ–µ —Å—Ç–µ–∫–ª–æ ===== */
.card {
  background: rgba(255,255,255,0.25);
  border-radius: 20px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 8px 32px rgba(31,38,135,0.1);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.25);
  transition: transform 0.2s;
}
.card:hover { transform: translateY(-2px); }

label { display:block;font-weight:600;margin-top:10px;color:#555;font-size:16px; }
input, select {
  width:100%; padding:12px; margin-top:6px;
  border-radius:14px; border:1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.15); color:#333; font-size:16px;
  box-sizing:border-box; backdrop-filter: blur(4px);
}
input::placeholder{color: rgba(0,0,0,0.4);}

/* ===== –ö–Ω–æ–ø–∫–∏ ===== */
button {
  width:100%; padding:14px; margin-top:14px;
  font-size:18px; font-weight:bold; color:#fff;
  background: linear-gradient(135deg, rgba(76,175,80,0.7), rgba(56,142,60,0.7));
  border:none; border-radius:14px;
  cursor:pointer; backdrop-filter: blur(6px);
  transition:0.2s, transform 0.2s;
}
button:hover { transform: translateY(-2px); }
button:active { transform: translateY(0px); background: linear-gradient(135deg, rgba(76,175,80,0.8), rgba(56,142,60,0.8)); }
.delete-day-btn { background: rgba(255,0,0,0.6); }
.delete-day-btn:hover { background: rgba(255,0,0,0.8); }

/* ===== –î–æ–ª–≥–∏ ===== */
.debt-item {
  display:flex; flex-direction:column; justify-content:space-between; align-items:flex-start;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.2); margin-bottom:6px;
}
.debt-item span { font-weight:600; font-size:15px; }
.edit-btn,.delete-btn {
  margin-top:6px; cursor:pointer; padding:6px 10px;
  border:none;border-radius:12px;color:#fff;font-size:14px; backdrop-filter: blur(6px);
}
.edit-btn { background: rgba(0,123,255,0.6); }
.edit-btn:hover { background: rgba(0,123,255,0.8); }
.delete-btn { background: rgba(255,0,0,0.6); }
.delete-btn:hover { background: rgba(255,0,0,0.8); }

/* ===== –ù–∞–≤–∏–≥–∞—Ü–∏—è ===== */
nav { display:flex; justify-content:space-around; margin-bottom:12px; }
nav button {
  width:auto; padding:10px 20px; background: rgba(255,255,255,0.2); border-radius:14px;
  font-size:16px; backdrop-filter: blur(6px); transition:0.2s;
}
nav button.active { background: rgba(255,255,255,0.35); }

/* ===== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ===== */
.result span.savings { color:#007BFF;font-weight:600; }
.result span.life { color:#FFC107;font-weight:600; }

@media(max-width:400px){
  .debt-item{font-size:14px;}
  .edit-btn,.delete-btn{padding:5px 8px;font-size:13px;}
}
</style>
</head>
<body>

<nav>
  <button id="btn-home" class="active" onclick="showPage('home')">–°–µ–≥–æ–¥–Ω—è</button>
  <button id="btn-debts" onclick="showPage('debts')">–î–æ–ª–≥–∏</button>
  <button id="btn-settings" onclick="showPage('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<!-- ===== –ì–ª–∞–≤–Ω–∞—è ===== -->
<div id="home" class="page">
  <h1>–°–µ–≥–æ–¥–Ω—è: <span id="today-date"></span></h1>
  <div class="card">
    <label for="income">–ó–∞—Ä–∞–±–æ—Ç–∞–ª —Å–µ–≥–æ–¥–Ω—è (‚ÇΩ)</label>
    <input type="number" id="income" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 3500">
    <button onclick="saveDay()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å</button>
    <button class="delete-day-btn" onclick="deleteTodayData()">–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å</button>
  </div>
  <div class="card">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <div class="result" id="output">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª.</div>
  </div>
  <div class="card">
    <h2>–ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–æ–≤</h2>
    <canvas id="incomeChart" style="width:100%;height:220px;"></canvas>
  </div>
</div>

<!-- ===== –î–æ–ª–≥–∏ ===== -->
<div id="debts" class="page" style="display:none;">
  <div class="card">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞</label>
    <input type="text" id="debt-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ö—Ä–µ–¥–∏—Ç">
    <label>–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞ (‚ÇΩ)</label>
    <input type="number" id="debt-total" placeholder="50000">
    <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ (‚ÇΩ)</label>
    <input type="number" id="debt-monthly" placeholder="5000">
    <button onclick="addDebt()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</button>
  </div>
  <div class="card">
    <h2>–°–ø–∏—Å–æ–∫ –¥–æ–ª–≥–æ–≤</h2>
    <div id="debts-list"></div>
    <div style="margin-top:10px;font-weight:bold;">–°—É–º–º–∞ –≤—Å–µ—Ö –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π: <span id="debts-total">0 ‚ÇΩ</span></div>
  </div>
</div>

<!-- ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ===== -->
<div id="settings" class="page" style="display:none;">
  <div class="card">
    <label>–°—É–º–º–∞ –Ω–∞ –∂–∏–∑–Ω—å –∑–∞ –º–µ—Å—è—Ü (‚ÇΩ)</label>
    <input type="number" id="life-month" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 25000" value="25000">
    <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
    <input type="color" id="bg-color" value="#e0e5ec">
    <label>–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫</label>
    <input type="color" id="btn-color" value="#4caf50">
    <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>
</div>

<script>
// ===== –ù–∞–≤–∏–≥–∞—Ü–∏—è =====
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('btn-'+id).classList.add('active');
}

// ===== –î–∞—Ç–∞ =====
function setToday(){ document.getElementById('today-date').innerText = new Date().toLocaleDateString(); }
setToday();

// ===== LocalStorage =====
let debts = JSON.parse(localStorage.getItem('debts'))||[];
let todayData = JSON.parse(localStorage.getItem('todayData'))||[];
let settings = JSON.parse(localStorage.getItem('settings'))||{lifeMonth:25000,bgColor:'#e0e5ec',btnColor:'#4caf50',savePercent:0.3};

// ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ =====
function saveSettings(){
  const life = Number(document.getElementById('life-month').value);
  const bg = document.getElementById('bg-color').value;
  const btn = document.getElementById('btn-color').value;
  if(life>0) settings.lifeMonth=life;
  if(bg) settings.bgColor=bg;
  if(btn) settings.btnColor=btn;
  localStorage.setItem('settings',JSON.stringify(settings));
  document.body.style.background=settings.bgColor;
  document.querySelectorAll('button').forEach(b=>b.style.background=settings.btnColor);
  alert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
}
document.body.style.background=settings.bgColor;
document.querySelectorAll('button').forEach(b=>b.style.background=settings.btnColor);

// ===== –î–æ–ª–≥–∏ =====
function saveDebts(){ localStorage.setItem('debts',JSON.stringify(debts)); }

function renderDebts(){
  const list = document.getElementById('debts-list'); list.innerHTML=''; let total=0;
  debts.forEach((d,i)=>{
    total+=Number(d.monthly);
    const div = document.createElement('div'); div.className='debt-item';
    div.innerHTML=`<span>${d.name}: –û–±—â–∞—è —Å—É–º–º–∞ ${d.total} ‚ÇΩ, –ú–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ ${d.monthly} ‚ÇΩ</span>
      <div><button class="edit-btn" onclick="editDebt(${i})">‚úèÔ∏è</button>
      <button class="delete-btn" onclick="deleteDebt(${i})">üóëÔ∏è</button></div>`;
    list.appendChild(div);
  });
  document.getElementById('debts-total').innerText=total+' ‚ÇΩ';
}

function addDebt(){
  const name=document.getElementById('debt-name').value;
  const total=Number(document.getElementById('debt-total').value);
  const monthly=Number(document.getElementById('debt-monthly').value);
  if(!name||!total||!monthly) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
  debts.push({name,total,monthly});
  saveDebts(); renderDebts();
  document.getElementById('debt-name').value=''; document.getElementById('debt-total').value=''; document.getElementById('debt-monthly').value='';
}
function deleteDebt(i){ debts.splice(i,1); saveDebts(); renderDebts(); }
function editDebt(i){
  const d=debts[i];
  const newName=prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–≥–∞:",d.name);
  const newTotal=prompt("–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞:",d.total);
  const newMonthly=prompt("–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂:",d.monthly);
  if(newName&&newTotal&&newMonthly){ debts[i]={name:newName,total:Number(newTotal),monthly:Number(newMonthly)}; saveDebts(); renderDebts(); }
}

// ===== –ì–ª–∞–≤–Ω–∞—è =====
function daysLeftInMonth(){
  const today=new Date(); 
  const lastDay=new Date(today.getFullYear(),today.getMonth()+1,0);
  return lastDay.getDate()-today.getDate()+1;
}
function getLifePerDay(){
  const today = new Date();
  const daysInMonth = new Date(today.getFullYear(), today.getMonth()+1, 0).getDate();
  return settings.lifeMonth / daysInMonth;
}

function saveDay(){
  const income=Number(document.getElementById('income').value); 
  if(!income||income<0) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–æ—Ö–æ–¥!");

  const debtSum = debts.reduce((a,d)=>a+Number(d.monthly),0);
  const leftDays = daysLeftInMonth();
  const dailyDebt=debtSum/leftDays;

  const restAfterDebt = income - dailyDebt;
  const lifeMinPerDay = getLifePerDay();
  let savings = 0;
  let life = 0;

  if(restAfterDebt <= lifeMinPerDay){
    life = restAfterDebt;
    savings = 0;
  } else {
    const maxSavings = restAfterDebt - lifeMinPerDay;
    const percentSavings = restAfterDebt * settings.savePercent;
    savings = Math.min(maxSavings, percentSavings);
    life = restAfterDebt - savings;
  }

  const today=new Date().toLocaleDateString();
  todayData.push({date:today,income,life,dailyDebt,savings});
  localStorage.setItem('todayData',JSON.stringify(todayData));
  renderToday(); renderChart();
}

function renderToday(){
  const output=document.getElementById('output');
  if(!todayData.length){ output.innerHTML="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å¬ª."; return; }
  const last=todayData[todayData.length-1];
  output.innerHTML=`
    üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–ª: ${last.income} ‚ÇΩ<br>
    üí≥ –ù–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂: ${Math.round(last.dailyDebt)} ‚ÇΩ<br>
    üè† –ù–∞ –∂–∏–∑–Ω—å: <span class="life">${Math.round(last.life)} ‚ÇΩ</span><br>
    üìà –ù–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è: <span class="savings">${Math.round(last.savings)} ‚ÇΩ</span>
  `;
}

function deleteTodayData(){
  if(!todayData.length) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
  if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å?")){ todayData.pop(); localStorage.setItem('todayData',JSON.stringify(todayData)); renderToday(); renderChart(); }
}

// ===== –ì—Ä–∞—Ñ–∏–∫ =====
let chart;
function renderChart(){
  const ctx=document.getElementById('incomeChart').getContext('2d');
  const labels=todayData.map(d=>d.date);
  const dataLife=todayData.map(d=>d.life);
  const dataDebt=todayData.map(d=>d.dailyDebt);
  const dataSavings=todayData.map(d=>d.savings);
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{labels,datasets:[
      {label:'–ñ–∏–∑–Ω—å', data:dataLife, backgroundColor:'rgba(255,193,7,0.7)'},
      {label:'–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂', data:dataDebt, backgroundColor:'rgba(244,67,54,0.7)'},
      {label:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è', data:dataSavings, backgroundColor:'rgba(33,150,243,0.7)'}
    ]},
    options:{
      responsive:true,
      plugins:{legend:{position:'top'}, tooltip:{mode:'index', intersect:false}},
      scales:{x:{stacked:true}, y:{stacked:true, beginAtZero:true}}
    }
  });
}

// ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
renderDebts(); renderToday(); renderChart();
</script>
</body>
</html>
